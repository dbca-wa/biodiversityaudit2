<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Explore the conservation status, threats, and management of Western Australia's biodiversity assets">
    <meta name="author" content="Florian.Mayer@dpaw.wa.gov.au">
    <link rel="icon" href="http://www.dpaw.wa.gov.au/templates/dpaw/favicon.ico">

    <title>WA Biodiversity Assets</title>
    
    <!-- download https://github.com/okfn/recline/zipball/master and extract as recline/ next to this file -->

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
     
    <!-- Recline CSS -->
    <link rel="stylesheet" href="recline/css/flot.css" />
    <link rel="stylesheet" href="recline/css/grid.css" />
    <link rel="stylesheet" href="recline/css/map.css" />
    <link rel="stylesheet" href="recline/css/multiview.css" />
    <link rel="stylesheet" href="recline/css/slickgrid.css" />
    <link rel="stylesheet" href="recline/css/timeline.css" />
    
    
  <style>
  /* GLOBAL STYLES -------------------------------------------------- */
  /* Padding below the footer and lighter body text */

  body {
  padding-bottom: 40px;
  color: #5a5a5a;
  background-color: #EEE;
  }


  /* CUSTOMIZE THE NAVBAR -------------------------------------------------- */

  /* Special class on .container surrounding .navbar, used for positioning it into place. */
  .navbar-wrapper {
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  z-index: 20;
  }

  /* Flip around the padding for proper display in narrow viewports */
  .navbar-wrapper > .container {
  padding-right: 0;
  padding-left: 0;
  }
  .navbar-wrapper .navbar {
  padding-right: 15px;
  padding-left: 15px;
  }
  .navbar-wrapper .navbar .container {
  width: auto;
  }




  /* MARKETING CONTENT
  -------------------------------------------------- */

  /* Center align the text within the three columns below the carousel */
  
  .marketing .col-lg-4 {
  margin-bottom: 20px;
  text-align: center;
  }
  .marketing h2 {
  font-weight: normal;
  }
  .marketing .col-lg-4 p {
  margin-right: 10px;
  margin-left: 10px;
  }


  /* Featurettes
  ------------------------- */

  .featurette-divider {
  margin: 80px 0; /* Space out the Bootstrap <hr> more */
  }

  /* Thin out the marketing headings */
  .featurette-heading {
  font-weight: 300;
  line-height: 1;
  letter-spacing: -1px;
  }


  /* RESPONSIVE CSS
  -------------------------------------------------- */

  @media (min-width: 768px) {
  /* Navbar positioning foo */
  .navbar-wrapper {
  margin-top: 20px;
  }
  .navbar-wrapper .container {
  padding-right: 15px;
  padding-left: 15px;
  }
  .navbar-wrapper .navbar {
  padding-right: 0;
  padding-left: 0;
  }

  /* The navbar becomes detached from the top, so we round the corners */
  .navbar-wrapper .navbar {
  border-radius: 4px;
  }

  /* Bump up size of carousel content */
  .carousel-caption p {
  margin-bottom: 20px;
  font-size: 21px;
  line-height: 1.4;
  }

  .featurette-heading {
  font-size: 50px;
  }
  }

  @media (min-width: 992px) {
  .featurette-heading {
  margin-top: 120px;
  }
  }
  

  .content { padding: 40px 15px;}
  .bigarea { height:800px; width: 100%;}
  #map {height: 700px;}
  .question {font-weight: bold;}
  .jql {color: #999;}
  
  </style>
  </head>
  
<!-- NAVBAR ================================================== -->

  <body>
    <div class="navbar-wrapper">
      <div class="container">

        <nav class="navbar navbar-inverse navbar-static-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#">WA Biodiversity Asset Explorer</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse navbar-right">
              <ul class="nav navbar-nav">
                <li><a href="#">Home</a></li>  
                <li><a href="#biogeography">Biogegraphy</a></li>
                <li><a href="#threats">Threats</a></li>
                <li><a href="#strategic">Strategic</a></li>
              </ul>
            </div>
          </div>
        </nav>

      </div>
    </div>


<!-- Content ================================================== -->
<!-- Wrap the rest of the page in another container to center all the content. -->

    <div class="container marketing">

      <!-- Three columns of text -->
      <div class="row" style="padding-top: 200px; padding-bottom: 400px;">
        <div class="col-lg-4">
          <img class="img-circle" src="http://internal-data.dpaw.wa.gov.au/uploads/group/20140226-084849.891197ahb.jpg" 
          alt="Biogeography image" style="width: 140px; height: 140px;">
          <h2>Biogegraphy of WA</h2>
          <p>Explore spatial, climatic and biodiversity characteristics of biogeographic IBRA subregions of Western Australia.</p>
          <p><a class="btn btn-default" href="#biogeography" role="button">Explore WA's Biogeography &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <img class="img-circle" src="http://d2tq98mqfjyz2l.cloudfront.net/image_cache/1367151180739698.png" 
          alt="shit's on fire yo" style="width: 140px; height: 140px;">
          <h2>Threats and Management</h2>
          <p>View threats and management implications for any asset at any region in an interactive, searchable summary of threatened taxa assessments.</p>
          <p><a class="btn btn-default" href="#threats" role="button">Dive into the data &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <img class="img-circle" src="http://s1.dmcdn.net/Ane7b/526x297-9oV.jpg" 
          alt="strategic questions image" style="width: 140px; height: 140px;">
          <h2>Strategic Questions</h2>
          <p>Explore the status of biodiversity assets by strategic questions.</p>
          <p><a class="btn btn-default" href="#strategic" role="button">Get the answers &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
      </div><!-- /.row -->


      <!-- START THE FEATURETTES -->

      <hr class="featurette-divider">

      <div class="row featurette" id="biogeography">
      <h2 class="featurette-heading">Biogegraphy of WA <span class="text-muted">regional summary</span></h2>
      <p class="lead">Discover the conservation status and profiles of terrestrial and marine assets.</p>
      
        <div class="col-md-7">
          
          <p>Terrestrial biodiversity assets are summarised by IBRA subregions.</p>
          <p>Marine biodiversity assets are summarised by Marine Protected Areas.</p>
          <p>Click any terrestrial region or Marine Protected Area to view details.</p>
          
          <div class="row well">
          <div class="row">
          <h3>Legend for Marine Assets</h3>
          </div>
          <div class="row">
          <div class="col-md-2">
                      <strong>Condition</strong>
            <p><div class="label label-success label-xs">Excellent</div></p>
            <p><div class="label label-success label-xs">Good</div></p>
            <p><div class="label label-default label-xs">Satisfactory</div></p>
            <p><div class="label label-warning label-xs">Unsatisfactory</div></p>
            <p><div class="label label-danger label-xs">Poor</div></p>
           </div>
           <div class="col-md-2">
            <strong>Pressure</strong>
            <p><div class="label label-success label-xs">Low</div></p>
            <p><div class="label label-default label-xs">Moderate</div></p>
            <p><div class="label label-warning label-xs">High</div></p>
            </div>
           <div class="col-md-2">
            <strong>Confidence</strong>
            <p><div class="glyphicon glyphicon-thumbs-up"> High </div></p>
            <p><div class="glyphicon glyphicon-hand-right"> Medium </div></p>
            <p><div class="glyphicon glyphicon-thumbs-down"> Low </div></p>
            </div>
           <div class="col-md-3">
            <strong>Pressure Trend</strong>
            <p><div class="label label-warning label-xs">Increasing <span 
              class="glyphicon glyphicon-arrow-up"></span></div></p>
            <p><div class="label label-default label-xs">Constant <span 
              class="glyphicon glyphicon-arrow-right"></span></div></p>
            <p><div class="label label-success label-xs">Decreasing <span 
              class="glyphicon glyphicon-arrow-down"></span></div></p>
            </div>
           <div class="col-md-2">
            <strong>Data</strong>
            <p><div class="label label-info label-xs">Not enough data <span 
              class="glyphicon glyphicon-warning-sign"></span></div></p>
          </div>
          </div>
          </div>
        </div>
        <div class="col-md-5">
          <div id="map"></div>
        </div>
      </div>
      <p class="pull-right"><a href="#">Back to top</a></p>

      <hr class="featurette-divider">

      <div class="row featurette" id="threats">
      
      <h2 class="featurette-heading">Threatened Taxa <span class="text-muted">and management actions</span></h2>
      
      <p><a class="btn btn-large btn-danger pull-right" target="_" src="http://aws-ckan-001:3333/project?project=2197168485958&ui=%7B%22facets%22%3A%5B%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Scale%22%2C%22columnName%22%3A%22Scale%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22DPaW%20region%22%2C%22columnName%22%3A%22DPaW%20region%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Schedule%22%2C%22columnName%22%3A%22Schedule%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Scientific%20name%22%2C%22columnName%22%3A%22Scientific%20name%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Common%20name%22%2C%22columnName%22%3A%22Common%20name%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%5D%7D">Open in new tab</a></p>
      
      <p class="lead">Browse threatened taxa, communities and wetlands by region and taxon.</p>
      <p>Select the region (scale) and/or taxon (scientific of common name) of interest to view our latest 
      knowledge of ecological details, threats and management actions about a taxon in a region. 
      Click the button to open the same data in a new tab for greater browsing comfort.</p>
     
        <div class="row">
        
        <!-- Alternatively we could show all the Fauna data in a ReclineJS dataviewer 
        Enable #faunadata together with JS at the end of this file, and hide the iframe
        -->
        <!-- div id="faunadata" class="bigarea"></div-->
      
         <!-- Show an OpenRefine view of the Fauna CSV -->     
        <iframe class="bigarea" src="http://aws-ckan-001:3333/project?project=2197168485958&ui=%7B%22facets%22%3A%5B%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Scale%22%2C%22columnName%22%3A%22Scale%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22DPaW%20region%22%2C%22columnName%22%3A%22DPaW%20region%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Schedule%22%2C%22columnName%22%3A%22Schedule%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Scientific%20name%22%2C%22columnName%22%3A%22Scientific%20name%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%2C%7B%22c%22%3A%7B%22type%22%3A%22list%22%2C%22name%22%3A%22Common%20name%22%2C%22columnName%22%3A%22Common%20name%22%2C%22expression%22%3A%22value%22%2C%22omitBlank%22%3Afalse%2C%22omitError%22%3Afalse%2C%22selectBlank%22%3Afalse%2C%22selectError%22%3Afalse%2C%22invert%22%3Afalse%7D%2C%22o%22%3A%7B%22sort%22%3A%22name%22%7D%2C%22s%22%3A%5B%5D%7D%5D%7D"></iframe>
        </div>
      </div>
      <p class="pull-right"><a href="#">Back to top</a></p>

      <hr class="featurette-divider">
      
      <div class="row featurette" id="strategic">
       <h2 class="featurette-heading">Strategic Questions <span class="text-muted"></span></h2>
       
       <p class="lead">List strategic questions with links to (filtered data containing) answers.</p>
       
       <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
       
          <!-- Communities at risk -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingEC">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseEC" aria-expanded="false" aria-controls="collapseEC">
                  Terrestrial Biodiversity Assets – Ecological communities at risk
                </a>
                <small class="pull-right text-muted">Table 10</small>
              </h4>
            </div>
            <div id="collapseEC" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingEC">
              <div class="panel-body">
         
                <!-- Question 33 -->
                <div class="question">How many extant Threatened Ecolocical Communities (TEC) occur in WA?</div>
                <div class="jql">The number of distinct ecological communities (EC_COMMUNITYNAME)
                with Conservation status (EC_STATUSWA) 'vulnerable', 'endangered' or 'critically endangered' 
                on Scale 'Western Australia' is:</div>
                <div class="answer" id="a33">calculating... (drum roll)</div>
                <!-- /Question 33 -->

              </div>
            </div>
          </div>
          
          <!-- Taxa at risk -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingTaxa">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTaxa" 
                aria-expanded="false" aria-controls="collapseTaxa">
                  Terrestrial Biodiversity Assets – Taxa at risk
                </a>
                <small class="pull-right text-muted">Table 11</small>
              </h4>
            </div>
            <div id="collapseTaxa" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTaxa">
              <div class="panel-body">
              
                 <!-- Question 57 -->
                <div class="question">How many extant Threatened Fanua Taxa occur in WA?</div>
                <div class="jql">The number of distinct 'Scientific name' on Scale 'Western Australia' is:</div>
                <div class="answer" id="a57">calculating...</div>
                <!-- /Question 57 -->
                
              </div>
            </div>
          </div>
          
          <!-- Aquatic Ecosystems -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingSwamp">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" 
                href="#collapseSwamp" aria-expanded="false" aria-controls="collapseSwamp">
                 Terrestrial Biodiversity Assets - Aquatic Ecosystems
                </a>
                <small class="pull-right text-muted"></small>
              </h4>
            </div>
            <div id="collapseSwamp" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSwamp">
              <div class="panel-body">
                Questions and answers.
              </div>
            </div>
          </div>
          
          <!-- Priority Flora -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingPF">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapsePF" 
                aria-expanded="false" aria-controls="collapsePF">
                  Priority Flora
                </a>
                <small class="pull-right text-muted"></small>
              </h4>
            </div>
            <div id="collapsePF" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingPF">
              <div class="panel-body">
                Questions and answers.
              </div>
            </div>
          </div>
          
        </div><!-- /panel-group -->
        
      <div style="height:300px;" id="hacky-spacer">
      </div><!-- /stratrow -->

      <hr class="featurette-divider">

      <!-- /Featurettes -->


      <!-- Footer -->
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>&copy; 2014 Ecoinformatics Program, Science and Conservation Division, Department of Parks and Wildlife &middot; 
        <a href="mailto:florian.mayer@dpaw.wa.gov.au?subject=BAE">Get in touch</a>
        <!--a href="#">Privacy</a> &middot; <a href="#">Terms</a></p-->
      </footer>
      <!-- /Footer -->

    </div><!-- /.container -->

    <!-- 3rd party JS libraries  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    
    <!-- recline -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>    

    <!-- recline slickgrid-->
    <script src="recline/vendor/slickgrid/2.0.1/jquery.event.drag-2.2.js"></script>
    <script src="recline/vendor/slickgrid/2.0.1/jquery.event.drop-2.2.js"></script>

    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/jquery.event.drag-2.0.min.js"></script>
    <!--script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/slick.grid.min.js"></script-->
    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/slick.core.js"></script>
    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/slick.formatters.js"></script>
    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/slick.editors.js"></script>
    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/slick.grid.js"></script>

    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/plugins/slick.rowselectionmodel.js"></script>
    <script type="text/javascript" src="recline/vendor/slickgrid/2.0.1/plugins/slick.rowmovemanager.js"></script>


    <script type="text/javascript" src="recline/vendor/moment/2.0.0/moment.js"></script>
    <script type="text/javascript" src="recline/vendor/timeline/js/timeline.js"></script>
    <!-- /recline slickgrid-->
  
    <!-- include the backend code you need e.g. here for csv -->
    <script type="text/javascript" src="http://okfnlabs.org/csv.js/csv.js"></script>

    <script type="text/javascript" src="http://okfnlabs.org/recline/dist/recline.js"></script>

    
    <!-- Custom JS  -->    
    <!-- LeafletJS map definition - move to leaflet_custom.js -->
    <script>
      var map = L.map('map').setView([-25, 120], 5);

      /* Styles for GeoJSON layes */
      var marine_style = {
          "color": "#0066ff",
          "weight": 2,
          "opacity": 0.8
      };
      
      var terrestrial_style = {
          "color": "#ff9933",
          "weight": 2,
          "opacity": 0.8
      };
      
      /* Background layer */
      L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap' +
        '</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">' +
        'CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
        id: 'examples.map-i875mjb7'
      }).addTo(map);

      /* Terrestrial layer: IBRA map */
      var ibra_url = "http://internal-data.dpaw.wa.gov.au/dataset/" + 
                      "10b54e2b-7226-4dfb-b3ef-30264cd0670a/resource/" + 
                      "d32d65a1-7ebe-4457-a208-03fd9f1a456f/download/ibra7.geojson"


      $.getJSON(ibra_url, function(data) {
        var terrestrial_assets = L.geoJson(data, {
          style: terrestrial_style,
          onEachFeature: function (feature, layer) {layer.bindPopup(feature.properties.popup);}});
        terrestrial_assets.addTo(map);
      });

      /* Marine layer: MPA map */
      var parks_url = "http://internal-data.dpaw.wa.gov.au/dataset/" + 
                      "0988fd6e-ee4f-47f1-8081-933b71219b51/resource/" + 
                      "9e8e00b6-3e07-4291-8f89-49b95cc3237e/download/cpr.json"

      $.getJSON(parks_url, function(data) {
        var marine_assets = L.geoJson(data, {
          style: marine_style,
          onEachFeature: function (feature, layer) {layer.bindPopup(feature.properties.assets);}});
        marine_assets.addTo(map);
      });
    </script>
    <!-- /LeafletJS map definition  -->
    
    <!-- Calculate answers to strategic questions - move to ckan_custom.js -->
    <script>
      /* Ajax JS queries call the CKAN-hosted Fauna CSV, process data and populate answer fields 
       * http://docs.ckan.org/en/latest/maintaining/datastore.html#ckanext.datastore.logic.action.datastore_search
       * TODO read all CSV once, then filter and process for each query
       */
    
      /* The CKAN resource ID of the Fauna CSV */
      var res_id = 'd66bf8af-9456-4b4b-a60c-3dbaa788bcfc';
  
      /* The CKAN API URL */
      var ckan_url = 'http://internal-data.dpaw.wa.gov.au/api/3/action/datastore_search';
      var ckan_sql_url = 'http://internal-data.dpaw.wa.gov.au/api/action/datastore_search_sql?sql=';
      var ckan_csv_url = 'http://internal-data.dpaw.wa.gov.au/datastore/dump/' + res_id;
      var fauna_csv_url = 'http://internal-data.dpaw.wa.gov.au/dataset/f843f4ca-5473-4b49-b0db-a93247b7d9f0/' +
                          'resource/d66bf8af-9456-4b4b-a60c-3dbaa788bcfc/download/' + 
                          'Biodiversity-Audit-II-Condition-of-Biological-Assets-version-MASTER-FAUNA-v17-xlsm.csv';
      
       
      /* One JQL query expressed through CKAN datastore_search parameters */
      var data_33 = {resource_id: res_id, 
        limit:10000,
        q:'JAF02'
        //filters (dictionary) – matching conditions to select, e.g {"key1": "a", "key2": "b"} 
        //q (string or dictionary) – full text query. 
        //   If q is a string, it’ll search on all fields on each row. 
        //   If q is a dictionary as {"key1": "a", "key2": "b"}, it'll search on each specific field (optional)
        //limit (int) – maximum number of rows to return (optional, default: 100)
        //distinct (bool) – return only distinct rows (optional, default: false)
        //fields (list or comma separated string) – fields to return (optional, default: all fields in original order)
        //sort (string) – comma separated field names with ordering e.g.: "fieldname1, fieldname2 desc"
      };
      
      /* Approach 1: One AJAX call to CKAN's datastore_search populates a total number and a data DOM element */
      $.ajax({
        url: ckan_url,
        data: data_33,
        jsonp : false,
        jsonpCallback: 'jsonCallback',
        success: function(data) {
          $("#a33")[0].innerHTML = (data.result.total);
          //TODO render data
        }
      });
      
      
      var data_57 = {resource_id: res_id, limit:10000,
        q:'Western Autralia',
        //fields:'Scale, Scientific name',
        limit: 10000,
      };
      
      /* Approach 1: Question 57 as datastore_search query */
      $.ajax({
        url: ckan_url,
        data: data_57,
        jsonp : false,
        jsonpCallback: 'jsonCallback',
        success: function(data) {
          $("#a57")[0].innerHTML = (data.result.total);
        }
      });
     
     /* Approach 2: Question 57 as CKAN Datastore SQL API call 
     var sql_57 = 'SELECT%20*%20from%20%'+ res_id + '%22%20WHERE%20Scale%20LIKE%20%27Western%20Australia%27';
     $.ajax({
        url: ckan_sql_url + sql_57,
        // fails with status 500 on CORS not allowed
        jsonp : false,
        jsonpCallback: 'jsonCallback',
        success: function(data) {
          $("#a57")[0].innerHTML = (data.result.total);
        }
      });*/
     
     /* Approach 3: Let's just shlorp the whole Fauna CSV once and process client-side. 
     $.ajax({
        url: ckan_csv_url,
        jsonp : false,
        jsonpCallback: 'jsonCallback',
        success: function(data) {
          //$("#fauna")[0].innerHTML = data;
        }
      }); */
        
      /* Approach 4: ReclineJS reads CSV from CKAN resource URL */
      recline.Backend.DataProxy.timeout = 10000; // patience you must have if big the data is
      var faunacsv = new recline.Model.Dataset({url: fauna_csv_url, rows: 10000, backend: 'csv'});
      // once data is fetched it will be stored in a local MemoryStore so further querying will not involve the DataProxy
      
/* To enable the ReclineJS dataviewer at #faunadata, enable the next line */
      //faunacsv.fetch();
      
      // Choose from simple Grid view:
      //var grid = new recline.View.Grid({ model: faunacsv });
      //$('#faunadata').append(grid.el);
      
      // or advanced Multiview:
      var views = [
        {
          id: 'grid',
          label: 'Grid',
          view: new recline.View.SlickGrid({
            model: faunacsv,
            state: {
              gridOptions: {
                editable: false,
                // Enable support for row add
                enabledAddRow: false,
                // Enable support for row delete
                enabledDelRow: false,
                // Enable support for row Reoder 
                enableReOrderRow:false,
                autoEdit: false,
                enableCellNavigation: true
              },
              columnsEditor: [
                { column: 'date', editor: Slick.Editors.Date },
                { column: 'title', editor: Slick.Editors.Text }
              ]
            }
          })
        }
        /*,
        { 
          // it's only text data, there's not much to plot 
          id: 'graph',
          label: 'Graph',
          view: new recline.View.Graph({ model: faunacsv })
        },
        {
          // there is already a leaflet map on this page
          id: 'map',
          label: 'Map',
          view: new recline.View.Map({  model: faunacsv })
        }*/
      ];
     
/* To enable the RelineJS dataviewer for #faunadata, enable the next line */
     //var multiView = new recline.View.MultiView({ model: faunacsv, el: $('#faunadata'), views: views });
    </script>


    <!-- /Custom JS  -->    
  </body>
</html>

